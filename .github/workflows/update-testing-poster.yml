name: Inject Main Poster into testing.html

on:
  push:
    paths:
      - api/event.json
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Inject static poster
        run: python3 -c "import json,re; e=json.load(open('api/event.json'))['event'][0]; html=open('testing.html').read(); poster=f'<!-- MAIN_POSTER_START -->\\n<div class=\"poster-wrapper\">\\n  <div class=\"poster-slider\">\\n    <img src=\"{e[\"poster_link\"]}\" alt=\"{e[\"title\"]} Live Streaming\" loading=\"eager\">\\n    <h1 class=\"match-title\">{e[\"title\"].replace(\" Vs \",\" <span class=\\\\\"vs-red\\\\\">VS</span> \")}</h1>\\n    <div class=\"match-meta\"><span>{e[\"league\"]}</span><span>•</span><span>{e[\"date\"]}</span><span>•</span><span>{e[\"start_time\"]}</span></div>\\n    <a href=\"/{e[\"watch_now\"][0][\"id\"]}\" class=\"watch-btn\">Watch Live</a>\\n  </div>\\n</div>\\n<!-- MAIN_POSTER_END -->'; html=re.sub(r'<!-- MAIN_POSTER_START -->[\\s\\S]*?<!-- MAIN_POSTER_END -->',poster,html); open('testing.html','w').write(html)"

      - name: Commit changes
        run: |
          git config user.name "poster-bot"
          git config user.email "bot@github.com"
          git add testing.html
          git commit -m "Update main poster from event.json" || exit 0
          git push
