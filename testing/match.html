<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Match Odds</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
body{background:#0b0f1a;color:#fff;padding:14px}

h2{margin-bottom:10px}
.section-title{
  margin:18px 0 10px;
  font-size:16px;
  font-weight:800;
  opacity:.9;
}

.market{
  background:linear-gradient(145deg,#151c30,#0f1424);
  border-radius:16px;
  padding:14px;
  margin-bottom:14px;
}

.market-name{
  font-weight:800;
  margin-bottom:10px;
}

.runner, .fancy-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:8px 0;
}

.odds span{
  padding:6px 10px;
  border-radius:8px;
  font-weight:800;
  margin-left:6px;
}

.back{background:#00ff88;color:#000}
.lay{background:#ff4d4d}

.fancy-box{
  background:#0e1527;
  padding:10px 12px;
  border-radius:12px;
  margin-bottom:8px;
}

.fancy-name{
  font-size:14px;
  font-weight:700;
  margin-bottom:6px;
}

.fancy-line{
  font-size:13px;
  opacity:.8;
}

.badge{
  font-size:11px;
  padding:3px 8px;
  border-radius:20px;
  font-weight:700;
}
.online{background:#00ff88;color:#000}
.suspend{background:#ffb020;color:#000}
</style>
</head>

<body>

<h2 id="title">Loading…</h2>

<!-- MATCH ODDS -->
<div id="matchOdds"></div>

<!-- FANCY ODDS -->
<div class="section-title">Fancy / Session Markets</div>
<div id="fancyOdds"></div>

<script>
const EVENT_ID = new URLSearchParams(location.search).get("eventId");
const API =
  "https://central.zplay1.in/pb/api/v1/events/matchDetails/" + EVENT_ID;

function bestBack(r){
  return r.ex?.b?.length ? Math.max(...r.ex.b.map(o=>o.p)) : null;
}
function bestLay(r){
  return r.ex?.l?.length ? Math.min(...r.ex.l.map(o=>o.p)) : null;
}

fetch(API)
.then(r=>r.json())
.then(d=>{
  const match = d.data.match;
  document.getElementById("title").innerText = match.eventName;

  /* ================= MATCH ODDS ================= */
  const matchBox = document.getElementById("matchOdds");
  match.matchOddData.forEach(market=>{
    let html="";

    market.runners.forEach(r=>{
      const back = bestBack(r);
      const lay  = bestLay(r);
      if(!back && !lay) return;

      const name =
        market.runnerName?.find(x=>x.SID===r.sid)?.RN || "Runner";

      html += `
        <div class="runner">
          <div>${name}</div>
          <div class="odds">
            ${back?`<span class="back">${back}</span>`:""}
            ${lay?`<span class="lay">${lay}</span>`:""}
          </div>
        </div>
      `;
    });

    if(html){
      matchBox.innerHTML += `
        <div class="market">
          <div class="market-name">${market.marketName}</div>
          ${html}
        </div>
      `;
    }
  });

  /* ================= FANCY ODDS ================= */
  const fancyBox = document.getElementById("fancyOdds");
  const fancyList = match.fancyOddData?.ml || [];

  fancyList.forEach(f=>{
    fancyBox.innerHTML += `
      <div class="fancy-box">
        <div class="fancy-name">
          ${f.mn}
          <span class="badge ${f.sn === "ONLINE" ? "online":"suspend"}">
            ${f.sn}
          </span>
        </div>

        <div class="fancy-row">
          <div class="fancy-line">
            Line: ${f.rn} – ${f.ry}
          </div>
          <div class="odds">
            <span class="back">${f.oy}</span>
            <span class="lay">${f.on}</span>
          </div>
        </div>
      </div>
    `;
  });
});
</script>

</body>
</html>
