<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CricTV - Premium Betting</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

html, body {
  height: 100%;
  background: linear-gradient(180deg, #00013a 0%, #071b4f 50%, #00013a 100%);
  color: #fff;
}

/* Particles */
#particles {
  position: fixed;
  inset: 0;
  z-index: 1;
  pointer-events: none;
}

/* Premium Header */
.premium-header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  background: linear-gradient(90deg, 
    rgba(11, 47, 124, 0.95) 0%,
    rgba(11, 42, 111, 0.95) 25%,
    rgba(7, 27, 79, 0.95) 50%,
    rgba(0, 1, 58, 0.95) 100%
  );
  backdrop-filter: blur(10px);
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.logo-section {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo-img {
  height: 32px;
}

.brand-name {
  font-size: 22px;
  font-weight: 900;
  background: linear-gradient(145deg, #fff 30%, #4d7fff 70%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: 0.5px;
}

.user-section {
  display: flex;
  align-items: center;
  gap: 20px;
}

.balance-display {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
}

.balance-label {
  font-size: 11px;
  opacity: 0.7;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.balance-amount {
  font-size: 18px;
  font-weight: 800;
  background: linear-gradient(145deg, #00ff88, #00cc6a);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  line-height: 1;
}

.premium-profile {
  width: 42px;
  height: 42px;
  border-radius: 12px;
  background: linear-gradient(145deg, #4d7fff, #2a5fff);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  position: relative;
  box-shadow: 0 6px 20px rgba(77, 127, 255, 0.3);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border: 2px solid rgba(255, 255, 255, 0.2);
}

.premium-profile:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 10px 30px rgba(77, 127, 255, 0.4);
}

.profile-icon {
  font-size: 20px;
  font-weight: bold;
}

/* Main Content */
.main-container {
  position: relative;
  z-index: 2;
  padding-top: 80px;
  height: calc(100vh - 80px);
  overflow-y: auto;
}

/* HERO SECTION */
.hero-section {
  padding: 25px 20px;
  text-align: center;
  background: linear-gradient(145deg, 
    rgba(11, 47, 124, 0.3),
    rgba(7, 27, 79, 0.2)
  );
  margin-bottom: 25px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.hero-title {
  font-size: 32px;
  font-weight: 900;
  margin-bottom: 10px;
  background: linear-gradient(145deg, #fff, #4d7fff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.hero-subtitle {
  font-size: 14px;
  opacity: 0.8;
  max-width: 500px;
  margin: 0 auto;
  line-height: 1.6;
}

/* STATS BAR */
.stats-bar {
  display: flex;
  justify-content: space-around;
  background: rgba(11, 15, 26, 0.7);
  margin: 0 20px 25px;
  padding: 15px;
  border-radius: 16px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.stat-item {
  text-align: center;
}

.stat-value {
  font-size: 24px;
  font-weight: 800;
  color: #00ff88;
  margin-bottom: 4px;
}

.stat-label {
  font-size: 11px;
  opacity: 0.7;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* MATCHES GRID */
.matches-section {
  padding: 0 20px 100px;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.section-title {
  font-size: 20px;
  font-weight: 800;
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-title::before {
  content: '';
  width: 4px;
  height: 20px;
  background: linear-gradient(145deg, #00ff88, #00cc6a);
  border-radius: 2px;
}

.refresh-btn {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: white;
  padding: 8px 16px;
  border-radius: 10px;
  font-size: 13px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: all 0.2s;
}

.refresh-btn:hover {
  background: rgba(255, 255, 255, 0.1);
}

/* MATCH CARDS */
.match-card {
  background: linear-gradient(145deg, 
    rgba(21, 28, 48, 0.95),
    rgba(15, 20, 36, 0.95)
  );
  border-radius: 20px;
  margin-bottom: 20px;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border: 1px solid rgba(255, 255, 255, 0.05);
  position: relative;
}

.match-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
  border-color: rgba(255, 255, 255, 0.1);
}

.match-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #00ff88, #4d7fff);
  opacity: 0;
  transition: opacity 0.3s;
}

.match-card:hover::before {
  opacity: 1;
}

.match-header {
  padding: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.league-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.league-name {
  font-size: 13px;
  opacity: 0.7;
  font-weight: 600;
}

.match-status {
  font-size: 11px;
  padding: 4px 10px;
  border-radius: 20px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-live {
  background: rgba(255, 77, 77, 0.2);
  color: #ff4d4d;
  border: 1px solid rgba(255, 77, 77, 0.3);
}

.status-upcoming {
  background: rgba(255, 170, 0, 0.2);
  color: #ffaa00;
  border: 1px solid rgba(255, 170, 0, 0.3);
}

.match-teams {
  font-size: 18px;
  font-weight: 800;
  line-height: 1.4;
}

.match-odds {
  padding: 20px;
}

.runner-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 15px;
  background: rgba(11, 15, 26, 0.8);
  border-radius: 12px;
  margin-bottom: 10px;
  transition: all 0.2s;
}

.runner-row:hover {
  background: rgba(11, 15, 26, 1);
  transform: translateX(4px);
}

.runner-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.team-flag {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: linear-gradient(145deg, #4d7fff, #2a5fff);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: bold;
}

.runner-name {
  font-size: 14px;
  font-weight: 600;
}

.odds-display {
  display: flex;
  gap: 8px;
}

.odds-value {
  min-width: 65px;
  padding: 10px;
  border-radius: 10px;
  font-weight: 800;
  font-size: 14px;
  text-align: center;
  transition: all 0.2s;
}

.odds-value:hover {
  transform: scale(1.05);
}

.odds-back {
  background: linear-gradient(145deg, #00ff88, #00cc6a);
  color: #000;
}

.odds-lay {
  background: linear-gradient(145deg, #ff4d4d, #ff3333);
  color: white;
}

.my-bet-info {
  margin-top: 8px;
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 8px;
  display: none;
}

.bet-win {
  background: rgba(0, 255, 136, 0.1);
  color: #00ff88;
  border: 1px solid rgba(0, 255, 136, 0.2);
}

.bet-lose {
  background: rgba(255, 77, 77, 0.1);
  color: #ff4d4d;
  border: 1px solid rgba(255, 77, 77, 0.2);
}

/* BET SETTLEMENT BANNER */
.settlement-banner {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(145deg, #00ff88, #00cc6a);
  color: #000;
  padding: 15px 25px;
  border-radius: 12px;
  font-weight: 800;
  font-size: 14px;
  z-index: 1000;
  box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
  display: none;
  animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
  from {
    transform: translateX(-50%) translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }
}

/* PROFILE MODAL */
.profile-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.9);
  z-index: 2000;
  display: none;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(10px);
}

.profile-modal-overlay.show {
  display: flex;
}

.premium-profile-modal {
  background: linear-gradient(145deg, 
    rgba(21, 28, 48, 0.95),
    rgba(15, 20, 36, 0.95)
  );
  border-radius: 24px;
  width: 90%;
  max-width: 500px;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 40px 80px rgba(0, 0, 0, 0.5);
}

.profile-modal-header {
  padding: 30px 30px 20px;
  background: linear-gradient(145deg, 
    rgba(11, 47, 124, 0.5),
    rgba(7, 27, 79, 0.5)
  );
  text-align: center;
}

.profile-modal-title {
  font-size: 28px;
  font-weight: 900;
  margin-bottom: 10px;
  background: linear-gradient(145deg, #fff, #4d7fff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.profile-modal-subtitle {
  font-size: 14px;
  opacity: 0.8;
}

.profile-modal-content {
  padding: 30px;
}

.balance-card-large {
  background: linear-gradient(145deg, #00ff88, #00cc6a);
  color: #000;
  padding: 25px;
  border-radius: 20px;
  text-align: center;
  margin-bottom: 30px;
  box-shadow: 0 15px 40px rgba(0, 255, 136, 0.2);
}

.balance-card-large .amount {
  font-size: 48px;
  font-weight: 900;
  line-height: 1;
  margin-bottom: 10px;
}

.balance-card-large .label {
  font-size: 14px;
  font-weight: 600;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  margin-bottom: 30px;
}

.stat-card {
  background: rgba(11, 15, 26, 0.8);
  padding: 20px;
  border-radius: 16px;
  text-align: center;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.stat-card .value {
  font-size: 24px;
  font-weight: 800;
  margin-bottom: 5px;
}

.stat-card .label {
  font-size: 12px;
  opacity: 0.7;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stat-card.win .value {
  color: #00ff88;
}

.stat-card.lose .value {
  color: #ff4d4d;
}

.profile-form {
  margin-bottom: 30px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  font-size: 13px;
  margin-bottom: 8px;
  opacity: 0.8;
  font-weight: 600;
}

.form-group input {
  width: 100%;
  padding: 15px;
  background: rgba(11, 15, 26, 0.8);
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  color: white;
  font-size: 16px;
  font-weight: 600;
  outline: none;
  transition: all 0.2s;
}

.form-group input:focus {
  border-color: #00ff88;
  box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
}

.modal-actions {
  display: flex;
  gap: 15px;
}

.modal-btn {
  flex: 1;
  padding: 18px;
  border-radius: 12px;
  border: none;
  font-weight: 800;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.3s;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.modal-btn.primary {
  background: linear-gradient(145deg, #00ff88, #00cc6a);
  color: #000;
}

.modal-btn.secondary {
  background: rgba(255, 255, 255, 0.05);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
}

/* SCROLLBAR STYLING */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(145deg, #4d7fff, #2a5fff);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(145deg, #2a5fff, #00ff88);
}

/* LOADING STATES */
.loading {
  text-align: center;
  padding: 40px;
  opacity: 0.7;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 3px solid rgba(255, 255, 255, 0.1);
  border-top-color: #00ff88;
  border-radius: 50%;
  margin: 0 auto 20px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* RESPONSIVE DESIGN */
@media (max-width: 768px) {
  .premium-header {
    padding: 0 15px;
    height: 55px;
  }
  
  .brand-name {
    font-size: 18px;
  }
  
  .balance-amount {
    font-size: 16px;
  }
  
  .hero-title {
    font-size: 24px;
  }
  
  .stats-bar {
    margin: 0 15px 20px;
    padding: 12px;
  }
  
  .stat-value {
    font-size: 20px;
  }
  
  .matches-section {
    padding: 0 15px 100px;
  }
  
  .runner-row {
    padding: 10px;
  }
}
</style>
</head>

<body>

<canvas id="particles"></canvas>

<!-- PREMIUM HEADER -->
<header class="premium-header">
  <div class="logo-section">
    <div class="brand-name">CRICTV</div>
  </div>
  
  <div class="user-section">
    <div class="balance-display">
      <div class="balance-label">Balance</div>
      <div class="balance-amount" id="userBalance">‚Çπ0</div>
    </div>
    <div class="premium-profile" onclick="openPremiumProfile()">
      <div class="profile-icon">üë§</div>
    </div>
  </div>
</header>

<!-- MAIN CONTENT -->
<main class="main-container">
  <!-- HERO SECTION -->
  <section class="hero-section">
    <h1 class="hero-title">Live Cricket Betting</h1>
    <p class="hero-subtitle">Premium betting experience with real-time odds, live updates, and instant settlements</p>
  </section>
  
  <!-- STATS BAR -->
  <div class="stats-bar" id="statsBar">
    <div class="stat-item">
      <div class="stat-value" id="totalMatches">0</div>
      <div class="stat-label">Live Matches</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" id="activeBets">0</div>
      <div class="stat-label">Active Bets</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" id="todayProfit">‚Çπ0</div>
      <div class="stat-label">Today's Profit</div>
    </div>
  </div>
  
  <!-- MATCHES SECTION -->
  <section class="matches-section">
    <div class="section-header">
      <h2 class="section-title">Live Matches</h2>
      <button class="refresh-btn" onclick="loadMatches()">
        <span>üîÑ</span> Refresh
      </button>
    </div>
    
    <div id="matchesContainer">
      <div class="loading">
        <div class="spinner"></div>
        Loading live matches...
      </div>
    </div>
  </section>
</main>

<!-- BET SETTLEMENT BANNER -->
<div class="settlement-banner" id="settlementBanner"></div>

<!-- PREMIUM PROFILE MODAL -->
<div class="profile-modal-overlay" id="profileModal">
  <div class="premium-profile-modal">
    <div class="profile-modal-header">
      <h2 class="profile-modal-title">Account Details</h2>
      <p class="profile-modal-subtitle">Manage your betting profile and track performance</p>
    </div>
    
    <div class="profile-modal-content">
      <div class="balance-card-large">
        <div class="amount" id="modalBalance">‚Çπ0</div>
        <div class="label">Available Balance</div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="value" id="totalBetsStat">0</div>
          <div class="label">Total Bets</div>
        </div>
        <div class="stat-card win">
          <div class="value" id="wonBetsStat">0</div>
          <div class="label">Won Bets</div>
        </div>
        <div class="stat-card lose">
          <div class="value" id="lostBetsStat">0</div>
          <div class="label">Lost Bets</div>
        </div>
        <div class="stat-card win">
          <div class="value" id="netProfitStat">‚Çπ0</div>
          <div class="label">Net Profit</div>
        </div>
      </div>
      
      <div class="profile-form" id="profileForm">
        <div class="form-group">
          <label for="userName">Your Name</label>
          <input type="text" id="userName" placeholder="Enter your full name">
        </div>
        
        <div class="form-group">
          <label for="userEmail">Email (Optional)</label>
          <input type="email" id="userEmail" placeholder="your.email@example.com">
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="modal-btn primary" onclick="saveProfile()">
          Save Profile
        </button>
        <button class="modal-btn secondary" onclick="closeProfile()">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// ==================== PARTICLE SYSTEM ====================
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
let w, h;
const particlesArray = [];

function initParticles() {
  resizeCanvas();
  createParticles();
  animateParticles();
}

function resizeCanvas() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}

function createParticles() {
  particlesArray.length = 0;
  for (let i = 0; i < 45; i++) {
    particlesArray.push({
      x: Math.random() * w,
      y: Math.random() * h,
      r: Math.random() * 1.4 + 0.4,
      vx: Math.random() * 0.15 + 0.05,
      vy: Math.random() * 0.1 + 0.03,
      a: Math.random() * 0.35 + 0.15
    });
  }
}

function animateParticles() {
  ctx.clearRect(0, 0, w, h);
  
  particlesArray.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;
    
    if (p.x > w) p.x = 0;
    if (p.y > h) p.y = 0;
    
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(255, 255, 255, ${p.a})`;
    ctx.fill();
  });
  
  requestAnimationFrame(animateParticles);
}

// ==================== USER PROFILE SYSTEM ====================
let userProfile = null;

function loadUserProfile() {
  try {
    const saved = localStorage.getItem('cricTV_premium_user');
    if (saved) {
      userProfile = JSON.parse(saved);
      updateUI();
      checkAndSettleBets();
      return true;
    }
  } catch (e) {
    console.error('Error loading profile:', e);
  }
  return false;
}

function createNewProfile() {
  userProfile = {
    id: 'USER_' + Date.now(),
    name: '',
    email: '',
    balance: 10000,
    createdAt: new Date().toISOString(),
    bets: [],
    activeBets: [],
    stats: {
      totalBets: 0,
      wonBets: 0,
      lostBets: 0,
      netProfit: 0,
      todayProfit: 0,
      lastUpdated: new Date().toISOString().split('T')[0]
    }
  };
  
  localStorage.setItem('cricTV_premium_user', JSON.stringify(userProfile));
  updateUI();
  openPremiumProfile();
}

function updateUI() {
  if (!userProfile) return;
  
  document.getElementById('userBalance').textContent = `‚Çπ${userProfile.balance.toLocaleString()}`;
  document.getElementById('modalBalance').textContent = `‚Çπ${userProfile.balance.toLocaleString()}`;
  
  document.getElementById('totalBetsStat').textContent = userProfile.stats.totalBets;
  document.getElementById('wonBetsStat').textContent = userProfile.stats.wonBets;
  document.getElementById('lostBetsStat').textContent = userProfile.stats.lostBets;
  document.getElementById('netProfitStat').textContent = `‚Çπ${userProfile.stats.netProfit.toLocaleString()}`;
  
  const today = new Date().toISOString().split('T')[0];
  if (userProfile.stats.lastUpdated !== today) {
    userProfile.stats.todayProfit = 0;
    userProfile.stats.lastUpdated = today;
    localStorage.setItem('cricTV_premium_user', JSON.stringify(userProfile));
  }
  
  document.getElementById('todayProfit').textContent = `‚Çπ${userProfile.stats.todayProfit.toLocaleString()}`;
  
  const activeBets = userProfile.bets.filter(bet => !bet.settled);
  document.getElementById('activeBets').textContent = activeBets.length;
  
  if (userProfile.name) {
    document.getElementById('userName').value = userProfile.name;
    document.getElementById('userEmail').value = userProfile.email || '';
  }
}

function openPremiumProfile() {
  if (!userProfile) {
    createNewProfile();
  } else {
    updateUI();
    document.getElementById('profileModal').classList.add('show');
  }
}

function closeProfile() {
  document.getElementById('profileModal').classList.remove('show');
}

function saveProfile() {
  if (!userProfile) return;
  
  const name = document.getElementById('userName').value.trim();
  const email = document.getElementById('userEmail').value.trim();
  
  if (!name) {
    alert('Please enter your name');
    return;
  }
  
  userProfile.name = name;
  userProfile.email = email;
  
  localStorage.setItem('cricTV_premium_user', JSON.stringify(userProfile));
  
  if (userProfile.balance === 10000) {
    showSettlement(`Welcome ${name}! ‚Çπ10,000 bonus credited to your account.`);
  }
  
  closeProfile();
  showSettlement('Profile updated successfully!');
}

// ==================== MATCHES DATA ====================
let matchesData = [];

async function loadMatches() {
  try {
    document.getElementById('matchesContainer').innerHTML = `
      <div class="loading">
        <div class="spinner"></div>
        Loading live matches...
      </div>
    `;
    
    const API = "https://central.zplay1.in/pb/api/v1/events/matches/4";
    const response = await fetch(API);
    const data = await response.json();
    
    if (data.data && Array.isArray(data.data)) {
      matchesData = data.data;
      renderMatches();
      updateStats();
    } else {
      throw new Error('Invalid data format');
    }
  } catch (error) {
    console.error('Error loading matches:', error);
    document.getElementById('matchesContainer').innerHTML = `
      <div class="loading">
        Failed to load matches. Please try again.
      </div>
    `;
  }
}

function renderMatches() {
  const container = document.getElementById('matchesContainer');
  
  if (!matchesData || matchesData.length === 0) {
    container.innerHTML = `
      <div class="loading">
        No live matches available at the moment.
      </div>
    `;
    return;
  }
  
  let html = '';
  
  matchesData.forEach(match => {
    const matchId = match.event_id;
    const matchBets = userProfile ? userProfile.bets.filter(bet => bet.eventId == matchId) : [];
    const activeMatchBets = matchBets.filter(bet => !bet.settled);
    
    const runnerNames = {};
    match.runnerNames?.forEach(runner => {
      runnerNames[runner.SID] = runner.RN;
    });
    
    let runnersHtml = '';
    match.runners?.forEach(runner => {
      const runnerName = runnerNames[runner.sid] || 'Team';
      const backOdds = runner.ex?.b?.[0]?.p;
      const layOdds = runner.ex?.l?.[0]?.p;
      
      const userBet = activeMatchBets.find(bet => bet.runnerId == runner.sid);
      
      runnersHtml += `
        <div class="runner-row">
          <div class="runner-info">
            <div class="team-flag">${runnerName.charAt(0)}</div>
            <div class="runner-name">${runnerName}</div>
          </div>
          <div class="odds-display">
            ${backOdds ? `
              <div class="odds-value odds-back">
                ${backOdds}
              </div>
            ` : ''}
            ${layOdds ? `
              <div class="odds-value odds-lay">
                ${layOdds}
              </div>
            ` : ''}
          </div>
        </div>
        ${userBet ? `
          <div class="my-bet-info ${userBet.type === 'back' ? 'bet-win' : 'bet-lose'}">
            Your ${userBet.type === 'back' ? 'Back' : 'Lay'} Bet: ‚Çπ${userBet.stake.toLocaleString()} 
            (Potential: ‚Çπ${userBet.potentialWin.toLocaleString()})
          </div>
        ` : ''}
      `;
    });
    
    const isLive = match.status === 'ACTIVE';
    const statusClass = isLive ? 'status-live' : 'status-upcoming';
    const statusText = isLive ? 'LIVE' : 'UPCOMING';
    
    html += `
      <div class="match-card" onclick="openMatch(${matchId})">
        <div class="match-header">
          <div class="league-info">
            <div class="league-name">${match.league_name || 'Cricket League'}</div>
            <div class="match-status ${statusClass}">${statusText}</div>
          </div>
          <div class="match-teams">${match.event_name || 'Match'}</div>
        </div>
        <div class="match-odds">
          ${runnersHtml || '<div class="loading">No odds available</div>'}
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

function updateStats() {
  if (!matchesData) return;
  
  document.getElementById('totalMatches').textContent = matchesData.length;
  
  if (userProfile) {
    const activeBets = userProfile.bets.filter(bet => !bet.settled);
    document.getElementById('activeBets').textContent = activeBets.length;
  }
}

function openMatch(matchId) {
  window.location.href = `match.html?eventId=${matchId}`;
}

// ==================== BET SETTLEMENT ====================
function checkAndSettleBets() {
  if (!userProfile || !matchesData.length) return;
  
  let settledCount = 0;
  let totalWinnings = 0;
  
  userProfile.bets.forEach(bet => {
    if (!bet.settled) {
      const match = matchesData.find(m => m.event_id == bet.eventId);
      if (match) {
        const runner = match.runners?.find(r => r.sid == bet.runnerId);
        if (runner) {
          if (runner.s === "WINNER") {
            bet.settled = true;
            bet.settledAt = new Date().toISOString();
            
            if (bet.type === 'back') {
              const winnings = bet.stake * bet.odds;
              userProfile.balance += winnings;
              bet.result = 'WIN';
              bet.winnings = winnings;
              userProfile.stats.wonBets++;
              userProfile.stats.netProfit += (winnings - bet.stake);
              userProfile.stats.todayProfit += (winnings - bet.stake);
              totalWinnings += winnings;
            } else if (bet.type === 'lay' && runner.s !== "WINNER") {
              userProfile.balance += bet.stake;
              bet.result = 'WIN';
              bet.winnings = bet.stake;
              userProfile.stats.wonBets++;
              userProfile.stats.netProfit += bet.stake;
              userProfile.stats.todayProfit += bet.stake;
              totalWinnings += bet.stake;
            } else {
              bet.result = 'LOSE';
              bet.winnings = 0;
              userProfile.stats.lostBets++;
              userProfile.stats.netProfit -= bet.stake;
              userProfile.stats.todayProfit -= bet.stake;
            }
            
            settledCount++;
          }
        }
      }
    }
  });
  
  if (settledCount > 0) {
    userProfile.stats.totalBets = userProfile.bets.length;
    localStorage.setItem('cricTV_premium_user', JSON.stringify(userProfile));
    
    updateUI();
    renderMatches();
    
    if (totalWinnings > 0) {
      showSettlement(`üí∞ ${settledCount} bet(s) settled! You won ‚Çπ${totalWinnings.toLocaleString()}`);
    }
  }
}

function showSettlement(message) {
  const banner = document.getElementById('settlementBanner');
  banner.textContent = message;
  banner.style.display = 'block';
  
  setTimeout(() => {
    banner.style.display = 'none';
  }, 5000);
}

// ==================== INITIALIZATION ====================
window.addEventListener('load', () => {
  initParticles();
  window.addEventListener('resize', () => {
    resizeCanvas();
    createParticles();
  });
  
  if (!loadUserProfile()) {
    createNewProfile();
  }
  
  loadMatches();
  setInterval(checkAndSettleBets, 10000);
});

setInterval(loadMatches, 30000);
  function settleMatchBets() {
  if (!matchData || !userProfile) return;

  // 1Ô∏è‚É£ Find winning runner (odds === 0.00)
  let winningRunnerId = null;

  matchData.matchOddData.forEach(market => {
    market.runners?.forEach(runner => {
      const backOdds = runner.ex?.b?.[0]?.p;
      if (backOdds === 0 || backOdds === "0.00") {
        winningRunnerId = runner.sid;
      }
    });
  });

  if (!winningRunnerId) return; // match not finished yet

  // 2Ô∏è‚É£ Settle all pending bets
  userProfile.bets.forEach(bet => {
    if (bet.settled || bet.eventId != EVENT_ID) return;

    let isWin = false;

    if (bet.type === "back") {
      isWin = bet.runnerId == winningRunnerId;
    } else if (bet.type === "lay") {
      isWin = bet.runnerId != winningRunnerId;
    }

    bet.settled = true;
    bet.result = isWin ? "WIN" : "LOSE";

    if (isWin) {
      userProfile.balance += bet.stake + bet.potentialWin;
      bet.winnings = bet.potentialWin;
      userProfile.stats.wonBets++;
      userProfile.stats.netProfit += bet.potentialWin;
      showSettlement(`üéâ YOU WON ‚Çπ${bet.potentialWin}`);
    } else {
      bet.winnings = 0;
      userProfile.stats.lostBets++;
      userProfile.stats.netProfit -= bet.stake;
      showSettlement(`‚ùå YOU LOST ‚Çπ${bet.stake}`);
    }
  });

  localStorage.setItem("cricTV_premium_user", JSON.stringify(userProfile));
  updateUI();
    }
</script>
</body>
</html>
