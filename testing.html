<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CricTV</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@800&display=swap');
html, body {
  margin: 0;
  height: 100%;
  overflow: hidden;
}

body {
  background: linear-gradient(
    180deg,
    #00013a 0%,
    #071b4f 50%,
    #00013a 100%
  );
}

.app-header {
  position: relative;
  z-index: 5;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(
    90deg,
    #0b2f7c 0%,
    #0b2a6f 35%,
    #071b4f 65%,
    #00013a 100%
  );
}

.app-header img {
  height: 25px;
}

#particles {
  position: fixed;
  inset: 0;
  z-index: 1;
  pointer-events: none;
}

.poster-wrapper {
  position: relative;
  z-index: 2;
}

.poster-slider {
  position: relative;
  width: 100vw;
  aspect-ratio: 16 / 9;
  overflow: hidden;
}

.skeleton {
  position: absolute;
  inset: 0;
  background: linear-gradient(
    180deg,
    #050b1f 0%,
    #07163a 50%,
    #050b1f 100%
  );
  overflow: hidden;
}

.skeleton::after {
  content: '';
  position: absolute;
  inset: -150%;
  background: linear-gradient(
    120deg,
    rgba(255,255,255,0) 40%,
    rgba(255,255,255,0.08) 50%,
    rgba(255,255,255,0) 60%
  );
  animation: shimmer 2.2s ease-in-out infinite;
}

@keyframes shimmer {
  from { transform: translateY(-60%); }
  to { transform: translateY(60%); }
}

.poster {
  position: absolute;
  inset: 0;
  opacity: 0;
  transition: opacity 2s cubic-bezier(.22,.61,.36,1);
}

.poster.active {
  opacity: 1;
}

.poster img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* VIGNETTE GRADIENT ADDED TO EACH POSTER */
.poster::after {
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 40%;
  background: linear-gradient(
    to top,
    rgba(0, 1, 58, 1.0) 0%,
    rgba(7, 27, 79, 0.7) 40%,
    rgba(7, 27, 79, 0.4) 65%,
    rgba(7, 27, 79, 0) 100%
  );
  z-index: 3;
  pointer-events: none;
}
.vs-red {
  color: #ff3b3b;
  font-weight: 900;
  margin: 0 4px;
}
/* Title above watch button - BOLD ON ALL DEVICES */
.match-title {
  position: absolute;
  left: 20px;
  bottom: 100px;
  z-index: 5;
  color: white;
  font-family: 'Arial', sans-serif;
  font-weight: 900;
  margin: 0;
  padding: 0;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.7);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: calc(100% - 100px); /* ADD THIS - prevents overlap with buttons */
  font-size: 28px;
  line-height: 1.1;
  text-transform: uppercase;
}

/* Metadata below title */
.match-meta {
  position: absolute;
  left: 20px;
  bottom: 80px;
  z-index: 7;
  color: rgba(255, 255, 255, 0.9);
  font-family: 'Arial', sans-serif;
  font-weight: 500;
  margin: 0;
  padding: 0;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
  text-shadow: 0 1px 4px rgba(0, 0, 0, 0.7);
  max-width: calc(100% - 100px); /* ADD THIS - prevents overlap with buttons */
}

/* Watch button styling - also limit width */
.watch-btn {
  position: absolute;
  left: 20px;
  bottom: 30px;
  z-index: 8;
  padding: 12px 28px;
  border-radius: 6px 0 0 6px;
  border: none;
  font-weight: 800;
  background: white;
  color: #00013a;
  cursor: pointer;
  box-shadow: none;
  transition: all 0.2s ease;
  font-size: 14px;
  letter-spacing: 0.5px;
  font-family: 'Arial', sans-serif;
  opacity: 1;
  max-width: calc(100% - 100px); /* ADD THIS - prevents button from stretching too far */
}

.watch-btn:hover {
  background: #f0f0f0;
}

.dots {
  position: absolute;
  bottom: 14px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 14px;
  z-index: 6;
}

.dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: rgba(255,255,255,0.4);
  transition: transform 0.4s ease, background 0.4s ease;
}

.dot.active {
  background: #ffffff;
  transform: scale(1.6);
}

.slide-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 42px;
  height: 42px;
  border-radius: 50%;
  border: none;
  background: rgba(0,0,0,0.45);
  color: #fff;
  font-size: 22px;
  z-index: 6;
}

.slide-btn.left { left: 12px; }
.slide-btn.right { right: 12px; }

/* Popup Styles */
.popup-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 1, 58, 0.85);
  z-index: 100;
  display: none;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(8px);
}

.popup-content {
  background: linear-gradient(135deg, #071b4f 0%, #00013a 100%);
  border-radius: 16px;
  padding: 24px;
  width: 90%;
  max-width: 400px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
  animation: popupFadeIn 0.3s ease-out;
}

@keyframes popupFadeIn {
  from {
    opacity: 0;
    transform: scale(0.95) translateY(10px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.popup-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.popup-header h3 {
  margin: 0;
  color: white;
  font-size: 20px;
  font-weight: 600;
}

.close-btn {
  background: transparent;
  border: none;
  color: rgba(255, 255, 255, 0.7);
  font-size: 24px;
  cursor: pointer;
  line-height: 1;
  padding: 0;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s;
}

.close-btn:hover {
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

.streams-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 20px;
}

.stream-item {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  padding: 16px;
  color: white;
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 12px;
}

.stream-item:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
}

.stream-item::before {
  content: "▶";
  font-size: 14px;
  opacity: 0.8;
}

.popup-footer {
  color: rgba(255, 255, 255, 0.6);
  font-size: 14px;
  text-align: center;
  padding-top: 16px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}
</style>
</head>
<body>
<canvas id="particles"></canvas>

<header class="app-header">
  <img src="https://crickettv.site/image/api/crickettv.png">
</header>

<div class="poster-wrapper">
  <div class="poster-slider" id="slider">
    <div class="skeleton" id="skeleton"></div>
    <button class="slide-btn left" id="prev">&#10094;</button>
    <button class="slide-btn right" id="next">&#10095;</button>
    <div class="dots" id="dots"></div>
  </div>
</div>

<!-- Popup -->
<div class="popup-overlay" id="popupOverlay">
  <div class="popup-content">
    <div class="popup-header">
      <h3 id="popupTitle">Select Stream</h3>
      <button class="close-btn" id="closePopup">&times;</button>
    </div>
    <div class="streams-list" id="streamsList">
      <!-- Content will be populated here -->
    </div>
    <div class="popup-footer" id="popupFooter">
      Select a stream to start watching
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');

let w, h;
function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

const particles = [];
for (let i = 0; i < 45; i++) {
  particles.push({
    x: Math.random() * w,
    y: Math.random() * h,
    r: Math.random() * 1.4 + 0.4,
    vx: Math.random() * 0.15 + 0.05,
    vy: Math.random() * 0.1 + 0.03,
    a: Math.random() * 0.35 + 0.15
  });
}

(function animate() {
  ctx.clearRect(0, 0, w, h);
  particles.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;
    if (p.x > w) p.x = 0;
    if (p.y > h) p.y = 0;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(255,255,255,${p.a})`;
    ctx.fill();
  });
  requestAnimationFrame(animate);
})();

const slider = document.getElementById('slider');
const dotsWrap = document.getElementById('dots');
const skeleton = document.getElementById('skeleton');
const prev = document.getElementById('prev');
const next = document.getElementById('next');
const popupOverlay = document.getElementById('popupOverlay');
const streamsList = document.getElementById('streamsList');
const closePopup = document.getElementById('closePopup');
const popupTitle = document.getElementById('popupTitle');
const popupFooter = document.getElementById('popupFooter');

let index = 0;
let autoTimer = null;
let resumeTimer = null;
let eventData = [];
let isPopupOpen = false;

const AUTO_INTERVAL = 5000;
const PAUSE_AFTER_USER = 10000;

function parseEventTime(e) {
  const [d, m, y] = e.date.split(" ");
  const M = {Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};
  let [h, min] = e.start_time.split(":");
  let p = "AM";
  if(min.includes(" ")) { 
    [min, p] = min.split(" "); 
  }
  h = parseInt(h); 
  min = parseInt(min);
  if(p === "PM" && h < 12) h += 12;
  if(p === "AM" && h === 12) h = 0;
  return new Date(Date.UTC(y, M[m], d, h - 5, min - 30));
}

function isLive(e) {
  return new Date() >= parseEventTime(e);
}

function createWatchButton(posterIndex) {
  const event = eventData[posterIndex];
  const p = slider.querySelectorAll('.poster')[posterIndex];
  
  // Create title element - UPPERCASE
  const titleElement = document.createElement('h2');
  titleElement.className = 'match-title';
  titleElement.textContent = event.title;
  p.appendChild(titleElement);
  
  // Create metadata element
  const metaElement = document.createElement('div');
  metaElement.className = 'match-meta';
  
  // Create metadata text with separators
  metaElement.innerHTML = `
    <span>${event.category}</span>
    <span class="meta-separator">•</span>
    <span>${event.language}</span>
    <span class="meta-separator">•</span>
    <span>${event.league}</span>
  `;
  p.appendChild(metaElement);
  
  // Create watch button
  const btn = document.createElement('button');
  btn.className = 'watch-btn';
  
  const live = isLive(event);
  btn.textContent = live ? 'Watch Now' : 'Upcoming';
  
  // Button hover effects
  btn.onmouseenter = () => {
    btn.style.background = '#f0f0f0';
  };
  btn.onmouseleave = () => {
    btn.style.background = 'white';
  };
  
  btn.onclick = (e) => {
    e.stopPropagation();
    if (isPopupOpen) return;
    
    const currentIndex = index;
    const currentEvent = eventData[currentIndex];
    const liveNow = isLive(currentEvent);
    
    if (liveNow) {
      showStreamPopup(currentIndex);
    } else {
      showUpcomingPopup(currentIndex);
    }
  };
  
  p.appendChild(btn);
  return btn;
}

function showUpcomingPopup(posterIndex) {
  const event = eventData[posterIndex];
  
  isPopupOpen = true;
  
  popupTitle.textContent = 'Match Info';
  
  streamsList.innerHTML = '';
  
  const infoDiv = document.createElement('div');
  infoDiv.style.color = 'white';
  infoDiv.style.textAlign = 'center';
  infoDiv.style.padding = '20px 0';
  
  infoDiv.innerHTML = `
    <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">Match Not Started Yet</div>
    <div style="font-size: 14px; margin-bottom: 8px; opacity: 0.9">Starts at: ${event.start_time}</div>
    <div style="font-size: 14px; margin-bottom: 8px; opacity: 0.9">Date: ${event.date}</div>
    <div style="font-size: 14px; margin-bottom: 8px; opacity: 0.9">League: ${event.league}</div>
    <div style="font-size: 14px; margin-bottom: 8px; opacity: 0.9">Language: ${event.language}</div>
    <div style="font-size: 14px; opacity: 0.9">Category: ${event.category}</div>
  `;
  
  streamsList.appendChild(infoDiv);
  
  popupFooter.textContent = 'Match will be available at the scheduled time';
  
  popupOverlay.style.display = 'flex';
}

function showStreamPopup(posterIndex) {
  const event = eventData[posterIndex];
  
  isPopupOpen = true;
  
  popupTitle.textContent = 'Select Stream';
  
  if (!event.watch_now || event.watch_now.length === 0) {
    streamsList.innerHTML = `
      <div style="color: white; text-align: center; padding: 20px 0; font-size: 16px;">
        No streams available for this match yet.
      </div>
    `;
    popupFooter.textContent = 'Check back later for available streams';
    popupOverlay.style.display = 'flex';
    return;
  }
  
  streamsList.innerHTML = '';
  
  event.watch_now.forEach(stream => {
    const streamItem = document.createElement('div');
    streamItem.className = 'stream-item';
    streamItem.textContent = stream.name;
    streamItem.onclick = () => {
      window.location.href = stream.id;
      closeStreamPopup();
    };
    streamsList.appendChild(streamItem);
  });
  
  popupFooter.textContent = 'Select a stream to start watching';
  
  popupOverlay.style.display = 'flex';
}

function closeStreamPopup() {
  isPopupOpen = false;
  popupOverlay.style.display = 'none';
}

closePopup.onclick = closeStreamPopup;
popupOverlay.onclick = (e) => {
  if (e.target === popupOverlay) {
    closeStreamPopup();
  }
};

let eventDataCache = null;
let isLoading = false;

function loadEventData() {
  if (eventDataCache) {
    return Promise.resolve(eventDataCache);
  }
  
  if (isLoading) {
    return new Promise(resolve => {
      const checkInterval = setInterval(() => {
        if (eventDataCache) {
          clearInterval(checkInterval);
          resolve(eventDataCache);
        }
      }, 100);
    });
  }
  
  isLoading = true;
  
  return fetch('https://crickettv.site/api/event.json')
    .then(r => r.json())
    .then(data => {
      eventDataCache = data.event;
      isLoading = false;
      return eventDataCache;
    })
    .catch(error => {
      console.error('Error loading event data:', error);
      isLoading = false;
      return [];
    });
}

loadEventData().then(data => {
  eventData = data;
  
  data.forEach((e, i) => {
    const p = document.createElement('div');
    p.className = 'poster' + (i === 0 ? ' active' : '');
    const img = document.createElement('img');
    img.src = e.poster_link;
    img.onload = () => {
      if (i === 0) skeleton.style.opacity = '0';
      createWatchButton(i);
    };
    img.onerror = () => {
      if (i === 0) skeleton.style.opacity = '0';
      createWatchButton(i);
    };
    p.appendChild(img);
    slider.appendChild(p);

    const d = document.createElement('div');
    d.className = 'dot' + (i === 0 ? ' active' : '');
    d.onclick = () => userChange(i);
    dotsWrap.appendChild(d);
  });

  startAuto();
});

function startAuto() {
  clearInterval(autoTimer);
  autoTimer = setInterval(() => change(index + 1), AUTO_INTERVAL);
}

function pauseAuto() {
  clearInterval(autoTimer);
  clearTimeout(resumeTimer);
  resumeTimer = setTimeout(startAuto, PAUSE_AFTER_USER);
}

function change(i) {
  const posters = slider.querySelectorAll('.poster');
  const dots = dotsWrap.children;

  posters[index].classList.remove('active');
  dots[index].classList.remove('active');

  index = (i + posters.length) % posters.length;

  posters[index].classList.add('active');
  dots[index].classList.add('active');
}

function userChange(i) {
  pauseAuto();
  change(i);
}

prev.onclick = () => userChange(index - 1);
next.onclick = () => userChange(index + 1);

let startX = 0;
slider.addEventListener('touchstart', e => {
  startX = e.touches[0].clientX;
  pauseAuto();
});

slider.addEventListener('touchend', e => {
  const endX = e.changedTouches[0].clientX;
  if (Math.abs(startX - endX) > 40) {
    change(startX > endX ? index + 1 : index - 1);
  }
});

document.addEventListener('click', function(e) {
  if (e.target.classList.contains('watch-btn') && isPopupOpen) {
    e.stopPropagation();
  }
}, true);
</script>
</body>
</html>
